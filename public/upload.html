<!doctype html>
<html>
	<head>
		<title>Uploader</title>
		<script src="./js/docx2html.js"></script>
		<style>
			button{width:50px;height:100px;position:absolute;top:50px; border: 0px; outline-style: none;}
			#load{
				border-radius:50px 0 0 50px;
				background-color: lightgreen;
				box-shadow: -1px 1px 4px 0.5px rgba(0,0,0,0.2);
				right:100px;
			}
			#save {
				border-radius:0 50px 50px 0;
				right:50px;
				box-shadow: 1px 1px 4px 0.5px rgba(0,0,0,0.2);
				background-color: lightgreen;
			}
			.doing {
				
			}
		</style>
		<script>
			window.parsed=null
			function $Id(id){
				return document.getElementById(id)
			}
			function serverSave(data,headers){
				var x = new XMLHttpRequest(), p=new $.Deferred();
				x.open("POST","/", true)
				
				x.onreadystatechange=function(e){
					switch(x.readyState){
					case 4:
						switch(x.status){
						case 200:
							p.resolve(x.responseText)
							break
						default:
							p.reject(new Error(x.responseText))
						}
					default:
					}
				}
				x.send(data)
				return p;
			}
			function save(){
				parsed.save({
					extendScript:'/js/extend.js',
					saveImage:function(data, docProps){
						return serverSave(data)
					},
					saveHtml: function(data, docProps){
						return serverSave(data, {props:JSON.stringify(docProps)})
					}
				})
				
				$Id('save').classList.add('doing')
			}
			
			
			function load(){
				require('docx2html')(this.files[0]).then(function(doc){
					parsed=doc
				}); 
				this.value=''
			}
		</script>
	</head>
	<body>
		<button id="load" onclick="$Id('file').click()">Load</button>
		<button id="save" onclick="save()">Save</button>
		<input type="file" id="file" style="position:absolute;top:-100px" onchange="load.call(this)">
	</body>
</html>